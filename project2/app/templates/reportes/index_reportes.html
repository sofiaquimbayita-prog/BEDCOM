{% extends 'includes/base.html' %}
{% load static %}

{% block header_title %}Gestión de Reportes{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'ap1/css/styles_reportes.css' %}">

<div id="data-bridge" 
     data-products='{{ js_products|safe|default:"[]" }}' 
     data-units='{{ js_units|safe|default:"[]" }}' 
     data-months='{{ js_months|safe|default:"[]" }}' 
     data-sales='{{ js_sales_values|safe|default:"[]" }}'
     style="display: none;">
</div>

<div class="dashboard">
    <div class="report-card">
        <div class="card-header">
            <h2>Resumen de Ventas</h2>
            <i class="fas fa-shopping-cart"></i>
        </div>
        <div class="sales-data">
            <div class="data-item">
                <span class="label">Producto más vendido:</span>
                <span class="value">{{ producto_top }}</span>
            </div>
            <div class="data-item">
                <span class="label">Total ingresos:</span>
                <span class="value highlight">${{ total_ventas }}</span>
            </div>
            <div class="data-item">
                <span class="label">Estado del sistema:</span>
                <span class="value" style="color: var(--color-exito);">Activo</span>
            </div>
        </div>
    </div>

    <div class="report-card">
        <div class="card-header">
            <h2>Logística y Despachos</h2>
            <i class="fas fa-truck"></i>
        </div>
        <div class="sales-data">
            <div class="alert {% if pendientes > 5 %}critica{% endif %}">
                <div class="alert-info">
                    <span class="label">Despachos en proceso</span>
                    <span class="value">{{ pendientes }} pedidos</span>
                </div>
                <i class="fas fa-clock highlight"></i>
            </div>
            <p style="font-size: 0.8rem; opacity: 0.8; margin-top: 10px;">
                * Los despachos dependen de la supervisión activa.
            </p>
        </div>
    </div>

    <div class="report-card">
        <div class="card-header">
            <h2>Alertas de Stock</h2>
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="alert critica">
            <div class="alert-info">
                <span class="label">Monitoreo de Insumos</span>
                <span class="value">Revisar stock crítico</span>
            </div>
            <i class="fas fa-bell highlight"></i>
        </div>
    </div>
</div>

<div class="charts-container">
    <div class="chart-card">
        <div class="card-header">
            <h2>Distribución de Ventas</h2>
            <i class="fas fa-chart-pie"></i>
        </div>
        <div class="chart-actions">
            <button class="chart-type-btn active" data-chart="salesChart" data-type="doughnut">Dona</button>
            <button class="chart-type-btn" data-chart="salesChart" data-type="bar">Barras</button>
        </div>
        <div class="chart-wrapper">
            <canvas id="salesChart"></canvas>
        </div>
    </div>

    <div class="chart-card">
        <div class="card-header">
            <h2>Evolución de Ingresos</h2>
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="chart-actions">
            <button class="chart-type-btn active" data-chart="monthlyChart" data-type="line">Línea</button>
            <button class="chart-type-btn" data-chart="monthlyChart" data-type="bar">Barras</button>
        </div>
        <div class="chart-wrapper">
            <canvas id="monthlyChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'ap1/js/script_reportes.js' %}"></script>
{% endblock %}